pipeline:

#  test:
#    image: node:alpine
#    commands:
#      - npm install -s
#      - npm test

  build:
    image: docker:dind
    commands:
      - docker build -t pinked/camera-synology-lister:latest .
      - docker login -u="chrisns" -p=${DOCKER_PASSWORD}
      - docker push pinked/camera-synology-lister:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  deploy:
    image: docker
    commands:
      - docker deploy --compose-file docker-compose.yml cameras
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock